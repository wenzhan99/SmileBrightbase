<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Smile Bright Dental — Manage Your Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../css/footer.css" />
  <style>
    :root{
      --primary:#1e4b86; --primary-600:#173b6a;
      --text:#243042; --muted:#6b7a90; --bg:#f5f7fb; --card:#ffffff;
      --ring:#e5e9f3; --shadow:0 8px 24px rgba(20,40,80,.08); --radius:14px;
      --success:#10b981; --warning:#f59e0b; --error:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg)}
    
    /* Navigation */
    .nav{
      background:#fff;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      position:sticky;top:0;z-index:100;
    }
    .nav-inner{
      max-width:1200px;margin:0 auto;padding:14px 20px;
      display:flex;align-items:center;justify-content:space-between;
    }
    .brand{
      font-weight:800;font-size:1.3rem;color:#243042;
      text-decoration:none;
    }
    .navlinks{
      display:flex;align-items:center;gap:5px;flex:1;justify-content:center;
    }
    .nav-item{position:relative}
    .nav-link{
      display:block;padding:10px 15px;text-decoration:none;color:#243042;
      font-weight:600;border-radius:6px;transition:all 0.2s ease;cursor:pointer;
    }
    .nav-link:hover,
    .nav-link:focus{color:#1e4b86;background:rgba(30,75,134,0.05)}
    .nav-link[aria-current="page"]{color:#1e4b86}
    .nav-link.has-dropdown::after{
      content:'▾';margin-left:4px;font-size:0.75em;display:inline-block;
      transition:transform 0.2s ease;
    }
    .nav-item.active .nav-link.has-dropdown::after{transform:rotate(180deg)}
    .dropdown{
      position:absolute;top:100%;left:0;min-width:220px;background:#fff;
      border-radius:8px;box-shadow:0 8px 24px rgba(0,0,0,.12);padding:8px 0;
      margin-top:8px;opacity:0;visibility:hidden;transform:translateY(-10px);
      transition:all 0.25s ease;pointer-events:none;
    }
    .nav-item:hover .dropdown,
    .nav-item:focus-within .dropdown,
    .nav-item.active .dropdown{
      opacity:1;visibility:visible;transform:translateY(0);pointer-events:auto;
    }
    .dropdown a{
      display:block;padding:10px 20px;color:#243042;text-decoration:none;
      font-weight:500;transition:all 0.15s ease;
    }
    .dropdown a:hover,
    .dropdown a:focus{background:rgba(30,75,134,0.08);color:#1e4b86;padding-left:24px}
    
    .btn{
      padding:10px 18px;border-radius:999px;border:none;background:#1e4b86;
      color:#fff;font-weight:700;cursor:pointer;transition:background 0.2s ease;
      white-space:nowrap;text-decoration:none;display:inline-block;
    }
    .btn:hover{background:#173b6a}
    .btn:disabled{background:#6c757d;cursor:not-allowed}
    
    /* Main Content */
    .main-content{
      padding:40px 20px;max-width:900px;margin:0 auto;
    }
    .booking-container{
      background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);
      padding:40px;margin-bottom:30px;
    }
    
    /* Header Band */
    .header-band{
      background:var(--primary);color:#fff;padding:24px 28px;
      border-radius:16px;margin-bottom:30px;
      display:flex;align-items:center;justify-content:space-between;
      flex-wrap:wrap;gap:15px;
    }
    .header-band h1{
      color:#fff;font-size:2rem;margin:0;
    }
    .header-band .breadcrumb{
      color:rgba(255,255,255,0.9);text-decoration:none;
      font-weight:600;transition:color 0.2s ease;
    }
    .header-band .breadcrumb:hover{
      color:#fff;
    }
    
    .booking-header{
      text-align:center;margin-bottom:30px;
    }
    .booking-header h1{
      color:var(--primary);font-size:2rem;margin-bottom:10px;
    }
    .booking-header p{
      color:var(--muted);font-size:1.1rem;
    }
    
    /* Status Banner */
    .status-banner{
      padding:15px 20px;border-radius:8px;margin-bottom:20px;
      font-weight:600;text-align:center;
    }
    .status-banner.success{background:#d1fae5;color:#065f46;border-left:4px solid var(--success)}
    .status-banner.error{background:#fee2e2;color:#991b1b;border-left:4px solid var(--error)}
    .status-banner.warning{background:#fef3c7;color:#92400e;border-left:4px solid var(--warning)}
    
    /* Verification Section */
    .verification-section{
      background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:30px;
      border-left:4px solid var(--primary);
    }
    .verification-section h3{
      color:var(--primary);margin-bottom:15px;font-size:1.2rem;
    }
    .verification-form{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;
      align-items:end;
    }
    
    /* Current Booking Display */
    .current-booking{
      background:#f8f9fa;border-radius:8px;padding:20px;margin-bottom:30px;
      border-left:4px solid var(--primary);
    }
    .current-booking h3{
      color:var(--primary);margin-bottom:15px;font-size:1.2rem;
    }
    .booking-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;
    }
    .booking-item{
      display:flex;flex-direction:column;
    }
    .booking-label{
      font-weight:600;color:var(--text);margin-bottom:5px;
    }
    .booking-value{
      color:var(--muted);font-size:0.95rem;
    }
    
    /* Edit Form */
    .edit-section{
      margin-bottom:30px;
    }
    .edit-section h3{
      color:var(--primary);margin-bottom:20px;font-size:1.3rem;
    }
    .form-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;
    }
    .form-group{
      display:flex;flex-direction:column;
    }
    .form-group label{
      font-weight:600;color:var(--text);margin-bottom:8px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea{
      padding:12px;border:2px solid var(--ring);border-radius:8px;
      font-size:1rem;transition:border-color 0.2s ease;
    }
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus{
      outline:none;border-color:var(--primary);
    }
    .form-group.full-width{
      grid-column:1/-1;
    }
    .form-group textarea{
      min-height:100px;resize:vertical;
    }
    
    /* Action Buttons */
    .action-buttons{
      display:flex;gap:15px;justify-content:center;margin-top:30px;
    }
    .action-button{
      padding:12px 24px;border-radius:8px;text-decoration:none;
      font-weight:600;transition:all 0.2s ease;border:none;cursor:pointer;
    }
    .action-button.primary{
      background:var(--primary);color:#fff;
    }
    .action-button.primary:hover{background:var(--primary-600)}
    .action-button.secondary{
      background:#6c757d;color:#fff;
    }
    .action-button.secondary:hover{background:#5a6268}
    .action-button:disabled{
      background:#6c757d;cursor:not-allowed;opacity:0.6;
    }
    
    /* Error Messages */
    .error-message{
      background:#fee;color:#c33;padding:15px;border-radius:8px;
      margin-bottom:20px;border-left:4px solid #c33;
    }
    
    @media (max-width: 768px) {
      .form-grid{
        grid-template-columns:1fr;
      }
      .booking-grid{
        grid-template-columns:1fr;
      }
      .verification-form{
        grid-template-columns:1fr;
      }
      .action-buttons{
        flex-direction:column;
      }
    }
  </style>
</head>
<body>

  <!-- ===== HEADER ===== -->
  <nav class="nav">
    <div class="nav-inner">
      <a href="../index.html" class="brand">Smile Bright Dental</a>
      
      <div class="navlinks">
        <div class="nav-item">
          <a href="../index.html" class="nav-link">Home</a>
        </div>
        
        <div class="nav-item">
          <a href="../about_us.html" class="nav-link has-dropdown" aria-haspopup="true" aria-expanded="false" onclick="toggleDropdown(event, this)">
            About Us
          </a>
          <div class="dropdown" role="menu">
            <a href="../about_us.html#team" role="menuitem">Our Team</a>
            <a href="../about_us.html#mission" role="menuitem">Mission & Values</a>
            <a href="../about_us.html#careers" role="menuitem">Careers</a>
            <a href="../about_us.html#contact" role="menuitem">Contact Us</a>
          </div>
        </div>
        
        <div class="nav-item">
          <a href="../services.html" class="nav-link has-dropdown" aria-haspopup="true" aria-expanded="false" onclick="toggleDropdown(event, this)">
            Services
          </a>
          <div class="dropdown" role="menu">
            <a href="../services.html#general" role="menuitem">General Dentistry</a>
            <a href="../services.html#scaling" role="menuitem">Scaling & Polishing</a>
            <a href="../services.html#braces" role="menuitem">Braces & Invisalign</a>
            <a href="../services.html#whitening" role="menuitem">Teeth Whitening</a>
            <a href="../services.html#implants" role="menuitem">Dental Implants</a>
            <a href="../services.html#wisdom" role="menuitem">Wisdom Tooth Surgery</a>
          </div>
        </div>
        
        <div class="nav-item">
          <a href="../clinics.html" class="nav-link has-dropdown" aria-haspopup="true" aria-expanded="false" onclick="toggleDropdown(event, this)">
            Clinics
          </a>
          <div class="dropdown" role="menu">
            <a href="../clinics.html#locations" role="menuitem">Locations</a>
            <a href="../clinics.html#hours" role="menuitem">Opening Hours</a>
            <a href="../clinics.html#insurance" role="menuitem">Insurance & CHAS</a>
            <a href="../book_appointmentbase.html" role="menuitem">Book Appointment</a>
          </div>
        </div>
        
        <div class="nav-item">
          <a href="../faq.html" class="nav-link has-dropdown" aria-expanded="false" onclick="toggleDropdown(event, this)">FAQ</a>
          <div class="dropdown" role="menu">
            <a href="../faq.html#pricing-longevity" role="menuitem">Pricing & Longevity</a>
            <a href="../faq.html#processes-procedures" role="menuitem">Processes & Procedures</a>
            <a href="../faq.html#patient-transfers" role="menuitem">Patient Transfers</a>
            <a href="../faq.html#chas-dental-subsidies" role="menuitem">CHAS Dental Subsidies</a>
          </div>
        </div>
        
        <div class="nav-item">
          <a href="../book_appointmentbase.html"><button class="btn" aria-current="page">Book Appointment</button></a>
        </div>
      </div>
    </div>
  </nav>

  <!-- ===== MAIN CONTENT ===== -->
  <div class="main-content">
    <div class="booking-container">
      
      <!-- Header Band -->
      <div class="header-band">
        <h1>Manage Your Booking</h1>
        <a href="../book_appointmentbase.html" class="breadcrumb">← Book New Appointment</a>
      </div>

      <!-- Status Banner -->
      <div id="statusBanner" class="status-banner" style="display: none;">
        <span id="statusMessage"></span>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="error-message" style="display: none;">
        <strong>Error:</strong> <span id="errorText"></span>
      </div>

      <!-- Verification Section - Uses PHP form submission -->
      <div class="verification-section">
        <h3>Verify Your Booking</h3>
        <form method="get" action="manage_booking.php">
          <div class="verification-form">
            <div class="form-group">
              <label for="referenceId">Reference ID *</label>
              <input type="text" id="referenceId" name="ref" required placeholder="SB-20250101-XXXX">
            </div>
            <div class="form-group">
              <label for="email">Email (Optional)</label>
              <input type="email" id="email" name="email" placeholder="your.email@example.com">
            </div>
            <div class="form-group">
              <button type="submit" class="btn">Load Booking</button>
            </div>
          </div>
        </form>
      </div>

      <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px; text-align: center;">
        <p style="color: var(--muted); margin-bottom: 15px;">To view or update your booking, please enter your reference ID above and click "Load Booking".</p>
        <p style="color: var(--muted); font-size: 0.9rem;">Your reference ID was sent to you in the booking confirmation email.</p>
      </div>

      <!-- Action Buttons -->
      <div class="action-buttons" style="margin-top: 30px;">
        <a href="booking_success.html" class="action-button secondary">Back to Success Page</a>
        <a href="../book_appointmentbase.html" class="action-button secondary">Book New Appointment</a>
      </div>

    </div>
  </div>

  <!-- ===== FOOTER ===== -->
  <footer class="site-footer">
    <div class="footer-inner">
      <section class="footer-col">
        <h3>Smile Bright Dental</h3>
        <p>We're committed to providing exceptional dental services in a comfortable and caring environment.</p>
      </section>
      <section class="footer-col">
        <h4>Quick Links</h4>
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="../about_us.html">About Us</a></li>
          <li><a href="../services.html">Services</a></li>
          <li><a href="../clinics.html">Clinics</a></li>
          <li><a href="../faq.html">FAQ</a></li>
          <li><a href="../book_appointmentbase.html">Book Appointment</a></li>
        </ul>
      </section>
      <section class="footer-col">
        <h4>Services</h4>
        <ul>
          <li><a href="../services.html#general">General Dentistry</a></li>
          <li><a href="../services.html#cosmetic">Cosmetic Dentistry</a></li>
          <li><a href="../services.html#orthodontics">Orthodontics</a></li>
          <li><a href="../services.html#implants">Dental Implants</a></li>
          <li><a href="../services.html#pediatric">Pediatric Dentistry</a></li>
          <li><a href="../services.html#emergency">Emergency Dentistry</a></li>
        </ul>
      </section>
      <section class="footer-col">
        <h4>Contact Info</h4>
        <ul class="contact">
          <li>123 Orchard Road<br/>Singapore 238858</li>
          <li>Phone: <a href="tel:+6562345678">+65 6234 5678</a></li>
          <li>Email: info@smilebrightdental.sg</li>
        </ul>
      </section>
    </div>
    <div class="footer-bottom">
      <p>© 2025 Smile Bright Dental. All rights reserved. · <a href="../privacy.html">Privacy Policy</a> · <a href="../terms.html">Terms of Service</a></p>
    </div>
  </footer>

  <script>
    // Base Version - Simple JavaScript only (NO AJAX, NO JSON, NO jQuery)
    
    // Mobile menu toggle
    function toggleMobileMenu() {
      const navMenu = document.getElementById('navMenu');
      if (navMenu) {
        navMenu.classList.toggle('active');
      }
    }
    
    // Dropdown toggle for mobile/touch devices
    function toggleDropdown(event, element) {
      if (window.innerWidth <= 900 || 'ontouchstart' in window) {
        event.preventDefault();
        const navItem = element.parentElement;
        const wasActive = navItem.classList.contains('active');
        
        document.querySelectorAll('.nav-item.active').forEach(item => {
          if (item !== navItem) {
            item.classList.remove('active');
            item.querySelector('.nav-link')?.setAttribute('aria-expanded', 'false');
          }
        });
        
        navItem.classList.toggle('active');
        element.setAttribute('aria-expanded', !wasActive);
      }
    }
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.nav-item')) {
        document.querySelectorAll('.nav-item.active').forEach(item => {
          item.classList.remove('active');
          item.querySelector('.nav-link')?.setAttribute('aria-expanded', 'false');
        });
      }
    });

    // Show status message from URL parameter (if redirected from PHP)
    window.addEventListener('DOMContentLoaded', function() {
      const urlParams = new URLSearchParams(window.location.search);
      
      // Check if reference ID is in URL - redirect to PHP page to load booking
      const ref = urlParams.get('ref');
      if (ref) {
        // Redirect to PHP page with reference ID (will handle display server-side)
        window.location.href = 'manage_booking.php?ref=' + encodeURIComponent(ref) + (urlParams.get('email') ? '&email=' + encodeURIComponent(urlParams.get('email')) : '');
        return;
      }
      
      const status = urlParams.get('status');
      const message = urlParams.get('message');
      
      if (status && message) {
        const banner = document.getElementById('statusBanner');
        const messageSpan = document.getElementById('statusMessage');
        
        if (banner && messageSpan) {
          banner.className = 'status-banner ' + status;
          messageSpan.textContent = decodeURIComponent(message);
          banner.style.display = 'block';
          
          // Remove from URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }
      
      const error = urlParams.get('error');
      if (error) {
        const errorDiv = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        
        if (errorDiv && errorText) {
          errorText.textContent = decodeURIComponent(error);
          errorDiv.style.display = 'block';
          
          // Remove from URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }
    });
  </script>
</body>
</html>

