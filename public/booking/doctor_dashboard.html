<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Doctor Dashboard - Smile Bright Dental</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --primary:#1e4b86; --primary-600:#173b6a;
      --text:#243042; --muted:#6b7a90; --bg:#f5f7fb; --card:#ffffff;
      --ring:#e5e9f3; --shadow:0 8px 24px rgba(20,40,80,.08); --radius:14px;
      --success:#10b981; --warning:#f59e0b; --error:#ef4444;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:var(--bg)}
    
    /* Header */
    .header{
      background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.06);
      padding:15px 20px;position:sticky;top:0;z-index:100;
    }
    .header-inner{
      max-width:1400px;margin:0 auto;
      display:flex;align-items:center;justify-content:space-between;
    }
    .header h1{
      color:var(--primary);font-size:1.5rem;
    }
    .header-info{
      display:flex;align-items:center;gap:20px;
    }
    .doctor-name{
      font-weight:600;color:var(--text);
    }
    .btn-logout{
      padding:8px 16px;border-radius:6px;border:none;
      background:var(--error);color:#fff;font-weight:600;
      cursor:pointer;transition:opacity 0.2s;
    }
    .btn-logout:hover{opacity:0.9}
    
    /* Main Content */
    .main-content{
      max-width:1400px;margin:0 auto;padding:30px 20px;
    }
    
    /* Filters */
    .filters{
      background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);
      padding:20px;margin-bottom:20px;
      display:flex;gap:15px;flex-wrap:wrap;align-items:end;
    }
    .filter-group{
      flex:1;min-width:200px;
    }
    .filter-group label{
      display:block;font-weight:600;margin-bottom:5px;
    }
    .filter-group select,
    .filter-group input{
      width:100%;padding:10px;border:2px solid var(--ring);border-radius:6px;
    }
    .btn-filter{
      padding:10px 20px;border-radius:6px;border:none;
      background:var(--primary);color:#fff;font-weight:600;
      cursor:pointer;
    }
    
    /* Stats */
    .stats{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:15px;margin-bottom:20px;
    }
    .stat-card{
      background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);
      padding:20px;text-align:center;
    }
    .stat-number{
      font-size:2rem;font-weight:700;color:var(--primary);
    }
    .stat-label{
      color:var(--muted);font-size:0.9rem;margin-top:5px;
    }
    
    /* Bookings Table */
    .bookings-container{
      background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);
      padding:20px;overflow-x:auto;
    }
    .bookings-header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:20px;
    }
    .bookings-header h2{
      color:var(--primary);
    }
    
    .table-wrapper{
      overflow-x:auto;
    }
    table{
      width:100%;border-collapse:collapse;min-width:1600px;
    }
    th{
      background:var(--bg);padding:12px 8px;text-align:left;
      font-weight:600;border-bottom:2px solid var(--ring);
      position:sticky;top:0;z-index:10;white-space:nowrap;
      font-size:0.85rem;
    }
    td{
      padding:10px 8px;border-bottom:1px solid var(--ring);
      font-size:0.9rem;max-width:200px;overflow:hidden;
      text-overflow:ellipsis;white-space:nowrap;
    }
    td.cell-expand{white-space:normal;max-width:250px}
    tr:hover{
      background:var(--bg);
    }
    
    .status-badge{
      padding:4px 10px;border-radius:12px;font-size:0.8rem;
      font-weight:600;display:inline-block;white-space:nowrap;
    }
    .status-booked{background:#e0e7ff;color:#3730a3}
    .status-confirmed{background:#dbeafe;color:#1e40af}
    .status-checked-in{background:#fef3c7;color:#92400e}
    .status-in-progress{background:#fef08a;color:#854d0e}
    .status-completed{background:#d1fae5;color:#065f46}
    .status-cancelled{background:#fee2e2;color:#991b1b}
    .status-no-show{background:#fce7f3;color:#9f1239}
    .status-rescheduled{background:#e0e7ff;color:#5b21b6}
    .status-scheduled{background:#dbeafe;color:#1e40af}
    
    .urgency-badge{
      padding:3px 8px;border-radius:8px;font-size:0.75rem;
      font-weight:600;display:inline-block;
    }
    .urgency-routine{background:#f3f4f6;color:#4b5563}
    .urgency-priority{background:#fef3c7;color:#92400e}
    .urgency-emergency{background:#fee2e2;color:#991b1b}
    
    .medical-flags{
      display:flex;gap:4px;flex-wrap:wrap;
    }
    .flag-badge{
      padding:2px 6px;border-radius:6px;font-size:0.7rem;
      background:#fee2e2;color:#991b1b;font-weight:600;
    }
    .flag-na{
      background:#f3f4f6;color:#6b7280;
    }
    
    .btn-edit{
      padding:6px 12px;border-radius:6px;border:none;
      background:var(--primary);color:#fff;font-size:0.8rem;
      font-weight:600;cursor:pointer;white-space:nowrap;
    }
    .btn-edit:hover{background:var(--primary-600)}
    
    /* Modal */
    .modal{
      display:none;position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,0.5);z-index:1000;
      align-items:center;justify-content:center;padding:20px;
    }
    .modal.active{display:flex}
    .modal-content{
      background:#fff;border-radius:var(--radius);
      max-width:600px;width:100%;max-height:90vh;overflow-y:auto;
      padding:30px;
    }
    .modal-header{
      display:flex;justify-content:space-between;align-items:center;
      margin-bottom:20px;
    }
    .modal-header h3{
      color:var(--primary);font-size:1.3rem;
    }
    .btn-close{
      background:none;border:none;font-size:1.5rem;
      cursor:pointer;color:var(--muted);
    }
    
    .form-group{
      margin-bottom:15px;
    }
    .form-group label{
      display:block;font-weight:600;margin-bottom:5px;
    }
    .form-group input,
    .form-group select,
    .form-group textarea{
      width:100%;padding:10px;border:2px solid var(--ring);
      border-radius:6px;
    }
    .form-group textarea{
      min-height:80px;resize:vertical;
    }
    
    .time-slots-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }
    .time-slot {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .time-slot:hover {
      background: #e8f4fd;
      border-color: var(--primary);
    }
    .time-slot.selected {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .modal-actions{
      display:flex;gap:10px;margin-top:20px;
    }
    .btn{
      flex:1;padding:12px;border-radius:6px;border:none;
      font-weight:600;cursor:pointer;
    }
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-600)}
    .btn-secondary{background:#6c757d;color:#fff}
    .btn-secondary:hover{background:#5a6268}
    
    .loading{
      text-align:center;padding:40px;color:var(--muted);
    }
    .no-bookings{
      text-align:center;padding:40px;color:var(--muted);
    }
    
    @media (max-width:768px){
      table{display:block;overflow-x:auto}
      .filters{flex-direction:column}
      .filter-group{min-width:100%}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-inner">
      <h1>ðŸ¦· Doctor Dashboard</h1>
      <div class="header-info">
        <span class="doctor-name" id="doctorName">Loading...</span>
        <button class="btn-logout" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>

  <div class="main-content">
    <!-- Filters -->
    <div class="filters">
      <div class="filter-group">
        <label>Status</label>
        <select id="filterStatus">
          <option value="">All Status</option>
          <option value="booked">Booked</option>
          <option value="confirmed">Confirmed</option>
          <option value="checked-in">Checked-In</option>
          <option value="in progress">In Progress</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
          <option value="no-show">No-Show</option>
          <option value="rescheduled">Rescheduled</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Urgency</label>
        <select id="filterUrgency">
          <option value="">All Urgency</option>
          <option value="routine">Routine</option>
          <option value="priority">Priority</option>
          <option value="emergency">Emergency</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Date</label>
        <input type="date" id="filterDate">
      </div>
      <button class="btn-filter" onclick="loadBookings()">Apply Filters</button>
    </div>

    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="statTotal">0</div>
        <div class="stat-label">Total Bookings</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statScheduled">0</div>
        <div class="stat-label">Scheduled</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="statToday">0</div>
        <div class="stat-label">Today</div>
      </div>
    </div>

    <!-- Bookings Table -->
    <div class="bookings-container">
      <div class="bookings-header">
        <h2>Your Appointments</h2>
      </div>
      
      <div id="loadingState" class="loading">
        Loading your appointments...
      </div>
      
      <div id="noBookingsState" class="no-bookings" style="display:none">
        No appointments found
      </div>
      
      <div id="bookingsTable" style="display:none">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Ref ID</th>
                <th>Patient</th>
                <th>Date</th>
                <th>Time</th>
                <th>Service</th>
                <th>Urgency</th>
                <th>Last Seen</th>
                <th>Recall Due</th>
                <th>Previous Dental Experience</th>
                <th>Medical Flags</th>
                <th>Additional Notes</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="bookingsBody">
              <!-- Bookings will be loaded here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Appointment</h3>
        <button class="btn-close" onclick="closeModal()">&times;</button>
      </div>
      
      <form id="editForm">
        <input type="hidden" id="editReferenceId">
        
        <div class="form-group">
          <label>Patient Name</label>
          <input type="text" id="editPatientName" readonly style="background:#f5f7fb">
        </div>
        
        <div class="form-group">
          <label>Date</label>
          <input type="date" id="editDate" required>
        </div>
        
        <div class="form-group">
          <label>Time</label>
          <input type="hidden" id="editTime" required>
          <div class="time-slots-grid" id="timeSlotsGrid">
            <div style="text-align: center; color: #6b7a90; padding: 20px;">
              Select a date to see available times
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Service</label>
          <input type="text" id="editService" readonly style="background:#f5f7fb">
        </div>
        
        <div class="form-group">
          <label>Urgency</label>
          <select id="editUrgency">
            <option value="Routine">Routine</option>
            <option value="Priority">Priority</option>
            <option value="Emergency">Emergency</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Status</label>
          <select id="editStatus">
            <option value="Booked">Booked</option>
            <option value="Confirmed">Confirmed</option>
            <option value="Checked-In">Checked-In</option>
            <option value="In Progress">In Progress</option>
            <option value="Completed">Completed</option>
            <option value="Cancelled">Cancelled</option>
            <option value="No-Show">No-Show</option>
            <option value="Rescheduled">Rescheduled</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Last Seen</label>
          <input type="date" id="editLastSeen">
        </div>
        
        <div class="form-group">
          <label>Recall Due</label>
          <input type="date" id="editRecallDue">
        </div>
        
        <div class="form-group">
          <label>Previous Dental Experience</label>
          <textarea id="editPreviousExperience" placeholder="Patient's dental history and preferences..."></textarea>
        </div>
        
        <div class="form-group">
          <label>Medical Flags</label>
          <input type="text" id="editMedicalFlags" placeholder="e.g., Asthma, Hypertension (comma-separated)">
          <small style="color:var(--muted);font-size:0.85rem;">Leave empty for N/A</small>
        </div>
        
        <div class="form-group">
          <label>Additional Notes</label>
          <textarea id="editAdditionalNotes" placeholder="Any additional notes about the appointment..."></textarea>
        </div>
        
        <div class="modal-actions">
          <button type="submit" class="btn btn-primary">Save Changes</button>
          <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add version parameter to force reload of JS file -->
  <!-- Doctor dashboard requires AJAX features not available in base version -->
  <div style="padding: 40px; text-align: center;">
    <h2>Doctor Dashboard</h2>
    <p>This feature requires advanced AJAX functionality and is not available in the base version.</p>
    <p>Please contact the administrator for access to the advanced dashboard.</p>
  </div>
</body>
</html>
